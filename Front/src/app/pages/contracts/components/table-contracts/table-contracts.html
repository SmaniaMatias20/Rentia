<div class="bg-gray-900 text-white rounded-xl shadow-lg overflow-hidden">

    <div class="p-4 bg-gray-900 border-b border-gray-800">
        <input type="text" [(ngModel)]="searchTerm" placeholder="Buscar en cualquier columna..."
            class="w-full px-4 py-2 rounded-lg bg-gray-800 text-white placeholder-gray-400 focus:outline-none focus:ring focus:ring-blue-600" />
    </div>


    <table class="w-full text-sm">
        <thead class="bg-gray-800 text-gray-300">
            <tr>
                <th class="px-4 py-3 text-left">Propiedad</th>
                <th class="px-4 py-3 text-left">Inquilino</th>
                <th class="px-4 py-3 text-left">Valor base</th>
                <th class="px-4 py-3 text-left">% Aumento</th>
                <th class="px-4 py-3 text-left">Frecuencia</th>
                <th class="px-4 py-3 text-left">Valor actual</th>
                <th class="px-4 py-3 text-left">Desde</th>
                <th class="px-4 py-3 text-left">Hasta</th>
                <th class="px-4 py-3 text-left">Vencimiento</th>
                <th class="px-4 py-3 text-left">Estado</th>
                <th class="px-4 py-3 text-left">Actualizar</th>
            </tr>
        </thead>

        <tbody>
            @for (contract of filteredContracts; track contract.id) {
            <tr class="border-t border-gray-800 transition" [ngClass]="{
    'bg-red-600/40 hover:bg-red-600/60': isExpired(contract),
    'bg-yellow-500/40 hover:bg-yellow-500/60': !isExpired(contract) && isExpiringSoon(contract),
    'hover:bg-gray-800': !isExpired(contract) && !isExpiringSoon(contract)
  }">

                <!-- Propiedad -->
                <td class="px-4 py-3">
                    {{ contract.property_name }}
                </td>

                <!-- Inquilino -->
                <td class="px-4 py-3">
                    {{ contract.tenant_name }}
                </td>

                <!-- Monto base -->
                <td class="px-4 py-3 font-semibold">
                    ${{ contract.rent_amount }}
                </td>

                <!-- % -->
                <td class="px-4 py-3">
                    {{ contract.increase_percentage }}%
                </td>


                <!-- Frecuencia -->
                <td class="px-4 py-3">
                    {{ formatFrequency(contract.increase_frequency) }}
                </td>

                <!-- Monto actualizado -->
                <td class="px-4 py-3 font-semibold">
                    ${{ calculateCurrentRent(contract) }}
                </td>

                <!-- Fechas -->
                <td class="px-4 py-3">
                    {{ formatDate(contract.valid_from) }}
                </td>

                <td class="px-4 py-3">
                    {{ formatDate(contract.valid_to) }}
                </td>

                <td class="px-4 py-3">
                    @if (isExpired(contract)) {
                    <span class="bg-red-600 px-2 py-1 rounded text-xs text-white">
                        Vencido
                    </span>
                    } @else if (isExpiringSoon(contract)) {
                    <span class="bg-yellow-600 px-2 py-1 rounded text-xs text-white">
                        Por vencer
                    </span>
                    } @else {
                    <span class="bg-gray-600 px-2 py-1 rounded text-xs text-white">
                        En fecha
                    </span>
                    }
                </td>

                <td class="px-4 py-3">
                    @if (contract.status) {
                    <span class="bg-green-600 px-2 py-1 rounded text-xs text-white">
                        Activo
                    </span>
                    } @else {
                    <span class="bg-red-600 px-2 py-1 rounded text-xs text-white">
                        Inactivo
                    </span>
                    }
                </td>

                <!-- Actualizar estado -->
                <td class="px-4 py-3">
                    <button
                        class="bg-red-600 hover:bg-red-700 text-white transition cursor-pointer rounded-lg p-2 flex items-center justify-center"
                        (click)="updateContractStatus.emit(contract)" title="Actualizar estado">
                        {{ contract.status ? 'Desactivar' : 'Activar' }}
                    </button>
                </td>

            </tr>
            }
        </tbody>

    </table>

    @if (filteredContracts.length === 0) {
    <p class="text-center text-gray-400 py-6">
        No hay contratos cargados
    </p>
    }
</div>